<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        * {
            padding: 0;
            margin: 0;
        }

        canvas {
            background: #eee;
            display: block;
            margin: auto;
        }
    </style>
</head>
<body>
<form id="form">
    <div class="coordinates">
        <div class="x_coordinate">
            <label for="x_field">X:</label>
            <select name = "x_coord" id="x_field">
                <option value="-5">-5</option>
                <option value="-4">-4</option>
                <option value="-3">-3</option>
                <option value="-2">-2</option>
                <option value="-1">-1</option>
                <option value="0" selected>0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
            </select>
        </div>
        <div class="y_coordinate">
            <label for="y_field">Y:</label>
            <input type="text" name="y_coord" id="y_field"
                   placeholder="[-3..5]" autocomplete="off">
        </div>
        <div class="r_coordinate">
            <label for="r_field">R:</label>
            <input type="text" name="r_coord" id="r_field"
                   placeholder="[2..5]" autocomplete="off">
        </div>
        <div class="data_submit">
            <button type="button" id="submit_button" onclick="printForm()">GO</button>
        </div>
    </div>
</form>
<canvas id="myCanvas" width="450" height="450"></canvas>
<script>
    var canvas = document.getElementById("myCanvas");
    canvas.addEventListener('click', function(e) {
        getCursorPosition(canvas, e)
    });
    var p_array = []
    var ctx = canvas.getContext('2d');
    for (let i = 0; i <= 4; i++) {
        p_array.push({x: i*2,
        y: i*2})
    }
    function getCursorPosition(canvas, event) {
        const rect = canvas.getBoundingClientRect();
        const r = document.getElementById('r_field').value;
        if (r === "" || r === 0) {
            alert('choose R!!!!')
        } else {
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            const newCoord =  toRadiusCoordinate(x, y, r, canvas);
            const oldCoord = toElementCoordinate(newCoord.x, newCoord.y, r, canvas);
            printPoint(ctx, oldCoord.x, oldCoord.y);
            console.log(x + ", " + y);
            console.log(newCoord);
            console.log(oldCoord);
        }
    }

    function toRadiusCoordinate(x, y, r, canvas) {
        const rect = canvas.getBoundingClientRect()
        const wight = rect.width;
        const height = rect.height;
        const x_coord = Math.round((((x - wight/2) / (wight/6)) * r) * 1000)/1000;
        const y_coord = Math.round(((-(y - height/2) / (height/6)) * r) * 1000)/1000;
        return {
            x: (x_coord === 0)?0:x_coord,
            y: (y_coord === 0)?0:y_coord
        }
    }


    function toElementCoordinate(x, y, r, canvas) {
        const rect = canvas.getBoundingClientRect()
        const wight = rect.width;
        const height = rect.height;
        return {
            x: (x * (wight/6) / r + (wight/2)),
            y: height - (y * (height/6) / r + (height/2))
        }
    }

    function printPoint(canvasCtx, x, y) {
        canvasCtx.beginPath();
        canvasCtx.arc(x, y, 5, 0, Math.PI*2, true);
        canvasCtx.fillStyle = "green";
        canvasCtx.fill();
        canvasCtx.closePath();
    }

    // const test = toElementCoordinate(0, 0, canvas);
    // console.log(test.x + ", " + test.y);
    // printPoint(ctx, test.x, test.y);
    // const test2 = toRadiusCoordinate(test.x, test.y, canvas);
    // console.log(test2.x + ", " + test2.y);

    function printForm() {
        this.event.preventDefault();
        const y = document.getElementById('y_field').value;
        const x = document.getElementById('x_field').value;
        const r = document.getElementById('r_field').value;
        const coords = toElementCoordinate(x, y, r, canvas);
        printPoint(ctx, coords.x, coords.y);
        p_array.forEach((item) => {
            const coords = toElementCoordinate(item.x, item.y, r, canvas);
            printPoint(ctx, coords.x, coords.y);
        })
    }










</script>
</body>
</html>